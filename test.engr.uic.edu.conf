<VirtualHost *:443>
    ServerName test.engr.uic.edu

    ProxyRequests Off
    ProxyVia On
    ProxyPreserveHost On
    AllowEncodedSlashes NoDecode

    # SSL certs
    SSLEngine on
    SSLCertificateFile /etc/pki/tls/certs/*.engr.uic.edu.crt
    SSLCertificateKeyFile /etc/pki/tls/private/*.engr.uic.edu.key
    SSLCertificateChainFile /etc/pki/tls/certs/server-chain.crt

    # Shibboleth handler
    <Location /Shibboleth.sso>
        SetHandler shib
    </Location>

    # Protect all URLs with Shibboleth and expose attributes as headers
    <Location />
        AuthType shibboleth
        ShibRequestSetting requireSession true
        ShibUseHeaders On
        Require shib-session
        Require valid-user
    </Location>

    # Proxy to Spring Boot on 8443
    ProxyPass / https://localhost:8443/
    ProxyPassReverse / https://localhost:8443/
    SSLProxyEngine On
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    SSLProxyCheckPeerExpire Off

    ErrorLog /var/log/httpd/shibboleth-spring-boot_error.log
    CustomLog /var/log/httpd/shibboleth-spring-boot_access.log combined
</VirtualHost>